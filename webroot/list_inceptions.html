<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">	
	<link rel="stylesheet" href="stylesheets/jungling.css" type="text/css"/>
	
    <script type="text/javascript" src="javascripts/jquery-1.4.4.js"></script>
  	<script language="javascript" src="javascripts/application.js"></script>
  	<script language="javascript" src="javascripts/inception.js"></script>
  	<script language="javascript" src="javascripts/concern.js"></script>
  	<script language="javascript" src="javascripts/checkpoint.js"></script>
	<script language="javascript" src="javascripts/status.js"></script>
    <title>Jungling</title>

</head>

<body>
	<div id='inceptionsPane' class='pane'>
		<div class='toolbar'>
			<div class='title'>Inceptions</div>
			<div class='buttons'>
				<input id='inceptionName' />
				<input class='back-button' type='button' value='New Inception' onclick="startNewInception()" />
			</div>
		</div>
		<div class="list-container"></div>
	</div>
	
	<div id='concernsPane' class='pane' style='display:none;'>
		<div class='toolbar'>
			<div class='title'></div>
			<div class='buttons'>
				<input class='back-button' type='button' value='Back' onclick="showInceptionsList()" />
			</div>
		</div>
		<div class="list-container"></div>
	</div>
	
	<div id='checkpointsPane' class='pane' style='display:none;'>
		<div class='toolbar'>
			<div class='title'></div>
			<div class='buttons'></div>
		</div>
		<div class="list-container"></div>
	</div>
	
	<div id='checkpointDetailPane' class='pane' style='display:none;'>
		<div class='toolbar'>
			<div class='title'></div>
			<div class='buttons'></div>
		</div>
		<div class="detail-container">
			<div id='description' class='list-item'></div>
			<div class='list-item'>
				<textarea id='comment'></textarea>
				<div id='operations'></div>
			</div>
		</div>
	</div>
	
	<script>
	function startNewInception() {
		var name = $('#inceptionName').val()
		if(name.length == 0) {
			alert("Please input Inception name")
			return
		}
		createInception(name)
		showInceptionsList()
	}
	
	function showInceptionsList() {
		showList($('#inceptionsPane'), listInceptions(), showConcernsList)
	}
	
	function showConcernsList(inception) {
		var pane = $('#concernsPane')
		pane.find('.title').text('Concerns Of [ ' + inception.title + ' ] ' + inception.getStatus() )
		showList(pane, inception.concerns, showCheckpointsList)		
	}
	
	function showCheckpointsList(concern) {
		var pane = $('#checkpointsPane')
		pane.find('.title').text('Checkpoints Of [ ' + concern.inception.title + ' > ' + concern.title + ' ] ' + concern.getStatus())
		
		var backButton = $("<input class='back-button' type='button' value='Back' />")
		backButton.click(function() {
			showConcernsList(concern.inception)
		})
		pane.find('.buttons').empty()
		pane.find('.buttons').append(backButton)
		
		showList(pane, concern.checkpoints, showCheckpointDetail)
	}
	
	function showCheckpointDetail(checkpoint) {
		var concern = checkpoint.concern
		var pane = $('#checkpointDetailPane')
		pane.find('.title').text('Checkpoint of [ ' + concern.inception.title + ' > ' + concern.title + ' > ' + checkpoint.title + ' ] ' + checkpoint.getStatus())
		
		var backButton = $("<input class='back-button' type='button' value='Back' />")
		backButton.click(function() {
			showCheckpointsList(concern)
		})
		pane.find('.buttons').empty()
		pane.find('.buttons').append(backButton)
		
		pane.find('#description').text(checkpoint.description)
		
		var commentTextArea = pane.find('#comment')
		commentTextArea.val(checkpoint.comment)

		var saveButton = checkpoint.saveButton('Save Comment', commentTextArea)
		var notDoneButton = checkpoint.saveButton('Not Done Yet...', commentTextArea, Status.NOT_DONE)
		var doneButton = checkpoint.saveButton('Done!', commentTextArea, Status.DONE)
		var notNeededButton = checkpoint.saveButton("We Don't Need This", commentTextArea, Status.NOT_NEEDED)
		
		var operationsDiv = pane.find('#operations')
		operationsDiv.empty()
		operationsDiv.append(saveButton)
		operationsDiv.append(notDoneButton)
		operationsDiv.append(doneButton)
		operationsDiv.append(notNeededButton)

		showPane(pane)
	}
	
	function showList(pane, items, detailHandler) {
		var container = pane.find('.list-container')
		container.empty()

		transactional(function(){
			$.each(items, function(index, item){
				var itemDiv = $("<div class='list-item'>" + item.title + "</div>")
				itemDiv.click(
					function() {
						$(".list-item").each(function(index, item) {
							$(item).removeClass('selected')
						}
					)
						$(this).addClass('selected')
					}
				)
				
				var viewItemButton = $("<div class='operations'><input type='button' value='See Detail' /></div>")
				viewItemButton.click(
					function() {
						return detailHandler(item)
					}
				)
				itemDiv.append(viewItemButton)
				
				container.append(itemDiv)
			})
		})
		
		showPane(pane)
	}
	
	function showPane(pane) {
		$(".pane").each(function(index, element) { 
			$(element).hide() 
		})		
		pane.show()		
	}
	
	showInceptionsList()
	</script>
</body>

</html>
