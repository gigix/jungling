<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">	
	<link rel="stylesheet" href="stylesheets/jungling.css" type="text/css"/>
	
    <script type="text/javascript" src="javascripts/jquery-1.4.4.js"></script>
  	<script language="javascript" src="javascripts/application.js"></script>
  	<script language="javascript" src="javascripts/inception.js"></script>
  	<script language="javascript" src="javascripts/concern.js"></script>
  	<script language="javascript" src="javascripts/checkpoint.js"></script>
	<script language="javascript" src="javascripts/status.js"></script>
    <title>Jungling</title>

</head>

<body>
	<div id='inceptionsPane' class='pane'>
		<div class='toolbar'>
			<div class='title'>Inceptions</div>
			<div class='buttons'>
				<input id='inceptionName' class='text-field' />
				<img alt='New Inception' onclick="startNewInception()"
					src="images/round_plus.png" />
			</div>
		</div>
		<div class="list-container"></div>
	</div>
	
	<div id='concernsPane' class='pane' style='display:none;'>
		<div class='toolbar'>
			<div class='title'></div>
			<div class='buttons'>
				<div class='back-button'>
					<img alt='Back' onclick="showInceptionsList()"
						src="images/round_arrow_left.png" />
				</div>
			</div>
		</div>
		<div class="list-container"></div>
	</div>
	
	<div id='checkpointsPane' class='pane' style='display:none;'>
		<div class='toolbar'>
			<div class='title'></div>
			<div class='buttons'></div>
		</div>
		<div class="list-container"></div>
	</div>
	
	<div id='checkpointDetailPane' class='pane' style='display:none;'>
		<div class='toolbar'>
			<div class='title'></div>
			<div class='buttons'></div>
		</div>
		<div class="detail-container">
			<div id='description' class='list-item detail-paragraph'></div>
			<div class='list-item'>
				<textarea id='comment' class='detail-paragraph'></textarea>
				<div id='operations'></div>
			</div>
		</div>
	</div>
	
	<script>
	function startNewInception() {
		var name = $('#inceptionName').val()
		if(name.length == 0) {
			alert("Please input Inception name")
			return
		}
		createInception(name)
		showInceptionsList()
	}
	
	function showInceptionsList() {
		showList($('#inceptionsPane'), listInceptions(), showConcernsList)
	}
	
	function showConcernsList(inception) {
		var pane = $('#concernsPane')
		var titleContainer = pane.find('.title')
		titleContainer.text(inception.title)
		showList(pane, inception.concerns, showCheckpointsList)		
	}
	
	function showCheckpointsList(concern) {
		var pane = $('#checkpointsPane')
		
		var titleContainer = pane.find('.title')
		titleContainer.empty()
		titleContainer.append(concern.breadcrumb(showConcernsList))
		
		var backButton = $("<img alt='Back' src='images/round_arrow_left.png' />")
		backButton.click(function() {
			showConcernsList(concern.inception)
		})
		pane.find('.buttons').empty()
		pane.find('.buttons').append(backButton)
		
		showList(pane, concern.checkpoints, showCheckpointDetail)
	}
	
	function showCheckpointDetail(checkpoint) {
		var concern = checkpoint.concern
		var pane = $('#checkpointDetailPane')
		
		var titleContainer = pane.find('.title')
		titleContainer.empty()
		titleContainer.append(checkpoint.breadcrumb(showCheckpointsList, showConcernsList))
		
		var backButton = $("<img alt='Back' src='images/round_arrow_left.png' />")
		backButton.click(function() {
			showCheckpointsList(concern)
		})
		pane.find('.buttons').empty()
		pane.find('.buttons').append(backButton)
		
		var descriptionContainer = pane.find('#description')
		descriptionContainer.text(checkpoint.description)
		
		var statusContainer = $("<div><br/></div>")
		statusContainer.append(statusTag(checkpoint))
		descriptionContainer.append(statusContainer)
		
		var commentTextArea = pane.find('#comment')
		commentTextArea.val(checkpoint.comment)

		var saveButton = checkpoint.saveButton('images/save.png', commentTextArea)
		var notDoneButton = checkpoint.saveButton('images/fire-32.png', commentTextArea, Status.NOT_DONE)
		var doneButton = checkpoint.saveButton('images/checkmark.png', commentTextArea, Status.DONE)
		var notNeededButton = checkpoint.saveButton("images/hand_contra-32.png", commentTextArea, Status.NOT_NEEDED)
		
		var operationsDiv = pane.find('#operations')
		operationsDiv.empty()
		operationsDiv.append(saveButton)
		operationsDiv.append(notDoneButton)
		operationsDiv.append(doneButton)
		operationsDiv.append(notNeededButton)

		showPane(pane)
	}
	
	function showList(pane, items, detailHandler) {
		var container = pane.find('.list-container')
		container.empty()

		transactional(function(){
			$.each(items, function(index, item){
				var itemDiv = $("<div class='list-item'>" + item.title + '&nbsp;' + statusTag(item) + "</div>")
				itemDiv.click(
					function() {
						$(".list-item").each(function(index, item) {
							$(item).removeClass('selected')
						}
					)
						$(this).addClass('selected')
					}
				)
				
				var viewItemButton = $("<div class='operations'><img src='images/arrow_right.png' alt='See Detail' /></div>")
				viewItemButton.click(
					function() {
						return detailHandler(item)
					}
				)
				itemDiv.append(viewItemButton)
				
				container.append(itemDiv)
			})
		})
		
		showPane(pane)
	}
	
	function showPane(pane) {
		$(".pane").each(function(index, element) { 
			$(element).hide() 
		})		
		pane.show()		
	}
	
	showInceptionsList()
	</script>
</body>

</html>
